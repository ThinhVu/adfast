function parseStateRef(t,e){var r,n=t.match(/^\s*({[^}]*})\s*$/);if(n&&(t=e+"("+n[1]+")"),r=t.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/),!r||4!==r.length)throw new Error("Invalid state ref '"+t+"'");return{state:r[1],paramExpr:r[3]||null}}function stateContext(t){var e=t.parent().inheritedData("$uiView");if(e&&e.state&&e.state.name)return e.state}function getTypeInfo(t){var e="[object SVGAnimatedString]"===Object.prototype.toString.call(t.prop("href")),r="FORM"===t[0].nodeName;return{attr:r?"action":e?"xlink:href":"href",isAnchor:"A"===t.prop("tagName").toUpperCase(),clickable:!r}}function clickHook(t,e,r,n,a){return function(i){var c=i.which||i.button,o=a();if(!(c>1||i.ctrlKey||i.metaKey||i.shiftKey||t.attr("target"))){var u=r(function(){e.go(o.state,o.params,o.options)});i.preventDefault();var f=n.isAnchor&&!o.href?1:0;i.preventDefault=function(){f--<=0&&r.cancel(u)}}}}function defaultOpts(t,e){return{relative:stateContext(t)||e.$current,inherit:!0}}function $StateRefDirective(t,e){return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(r,n,a,i){var c,o=parseStateRef(a.uiSref,t.current.name),u={state:o.state,href:null,params:null},f=getTypeInfo(n),s=i[1]||i[0],l=null;u.options=extend(defaultOpts(n,t),a.uiSrefOpts?r.$eval(a.uiSrefOpts):{});var p=function(e){e&&(u.params=angular.copy(e)),u.href=t.href(o.state,u.params,u.options),l&&l(),s&&(l=s.$$addStateInfo(o.state,u.params)),null!==u.href&&a.$set(f.attr,u.href)};o.paramExpr&&(r.$watch(o.paramExpr,function(t){t!==u.params&&p(t)},!0),u.params=angular.copy(r.$eval(o.paramExpr))),p(),f.clickable&&(c=clickHook(n,t,e,f,function(){return u}),n[n.on?"on":"bind"]("click",c),r.$on("$destroy",function(){n[n.off?"off":"unbind"]("click",c)}))}}}function $StateRefDynamicDirective(t,e){return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(r,n,a,i){function c(e){p.state=e[0],p.params=e[1],p.options=e[2],p.href=t.href(p.state,p.params,p.options),v&&v(),f&&(v=f.$$addStateInfo(p.state,p.params)),p.href&&a.$set(u.attr,p.href)}var o,u=getTypeInfo(n),f=i[1]||i[0],s=[a.uiState,a.uiStateParams||null,a.uiStateOpts||null],l="["+s.map(function(t){return t||"null"}).join(", ")+"]",p={state:null,params:null,options:null,href:null},v=null;r.$watch(l,c,!0),c(r.$eval(l)),u.clickable&&(o=clickHook(n,t,e,u,function(){return p}),n[n.on?"on":"bind"]("click",o),r.$on("$destroy",function(){n[n.off?"off":"unbind"]("click",o)}))}}}function $StateRefActiveDirective(t,e,r){return{restrict:"A",controller:["$scope","$element","$attrs","$timeout",function(e,n,a,i){function c(e,r,a){var i=t.get(e,stateContext(n)),c=o(e,r),u={state:i||{name:e},params:r,hash:c};return m.push(u),h[c]=a,function(){var t=m.indexOf(u);t!==-1&&m.splice(t,1)}}function o(t,r){if(!isString(t))throw new Error("state should be a string");return isObject(r)?t+toJson(r):(r=e.$eval(r),isObject(r)?t+toJson(r):t)}function u(){for(var t=0;t<m.length;t++)l(m[t].state,m[t].params)?f(n,h[m[t].hash]):s(n,h[m[t].hash]),p(m[t].state,m[t].params)?f(n,v):s(n,v)}function f(t,e){i(function(){t.addClass(e)})}function s(t,e){t.removeClass(e)}function l(e,r){return t.includes(e.name,r)}function p(e,r){return t.is(e.name,r)}var v,$,m=[],h={};v=r(a.uiSrefActiveEq||"",!1)(e);try{$=e.$eval(a.uiSrefActive)}catch(t){}$=$||r(a.uiSrefActive||"",!1)(e),isObject($)&&forEach($,function(r,n){if(isString(r)){var a=parseStateRef(r,t.current.name);c(a.state,e.$eval(a.paramExpr),n)}}),this.$$addStateInfo=function(t,e){if(!(isObject($)&&m.length>0)){var r=c(t,e,$);return u(),r}},e.$on("$stateChangeSuccess",u),u()}]}}$StateRefDirective.$inject=["$state","$timeout"],$StateRefDynamicDirective.$inject=["$state","$timeout"],$StateRefActiveDirective.$inject=["$state","$stateParams","$interpolate"],angular.module("ui.router.state").directive("uiSref",$StateRefDirective).directive("uiSrefActive",$StateRefActiveDirective).directive("uiSrefActiveEq",$StateRefActiveDirective).directive("uiState",$StateRefDynamicDirective);