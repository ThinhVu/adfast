!function(){var e="function"==typeof require?require(".."):window._;QUnit.module("Functions"),QUnit.config.asyncRetries=3,QUnit.test("bind",function(t){var n={name:"moe"},a=function(e){return"name: "+(this.name||e)},i=e.bind(a,n);t.equal(i(),"name: moe","can bind a function to a context"),i=e(a).bind(n),t.equal(i(),"name: moe","can do OO-style binding"),i=e.bind(a,null,"curly");var o=i();t.ok("name: curly"===o||o==="name: "+window.name,"can bind without specifying a context"),a=function(e,t){return e+": "+t},a=e.bind(a,this,"hello"),t.equal(a("moe"),"hello: moe","the function was partially applied in advance"),a=e.bind(a,this,"curly"),t.equal(a(),"hello: curly","the function was completely applied in advance"),a=function(e,t,n){return e+": "+t+" "+n},a=e.bind(a,this,"hello","moe","curly"),t.equal(a(),"hello: moe curly","the function was partially applied in advance and can accept multiple arguments"),a=function(e,n){t.equal(this,e,n)},e.bind(a,0,0,"can bind a function to `0`")(),e.bind(a,"","","can bind a function to an empty string")(),e.bind(a,!1,!1,"can bind a function to `false`")();var r=function(){return this},l=e.bind(r,{hello:"moe curly"}),u=l,c=new u;t.equal(c.hello,void 0,"function should not be bound to the context, to comply with ECMAScript 5"),t.equal(l().hello,"moe curly","When called without the new operator, it's OK to be bound to the context"),t.ok(c instanceof r,"a bound instance is an instance of the original function"),t.raises(function(){e.bind("notafunction")},TypeError,"throws an error when binding to a non-function")}),QUnit.test("partial",function(t){function n(e,t){this.name=e,this.options=t}var a={name:"moe"},i=function(){return this.name+" "+e.toArray(arguments).join(" ")};a.func=e.partial(i,"a","b"),t.equal(a.func("c","d"),"moe a b c d","can partially apply"),a.func=e.partial(i,e,"b",e,"d"),t.equal(a.func("a","c"),"moe a b c d","can partially apply with placeholders"),i=e.partial(function(){return arguments.length},e,"b",e,"d"),t.equal(i("a","c","e"),5,"accepts more arguments than the number of placeholders"),t.equal(i("a"),4,"accepts fewer arguments than the number of placeholders"),i=e.partial(function(){return typeof arguments[2]},e,"b",e,"d"),t.equal(i("a"),"undefined","unfilled placeholders are undefined"),n.prototype.get=function(){return this.name};var o=e.partial(n,e,{a:1}),r=new o("foo");t.ok(r instanceof n,"Can partially bind a constructor"),t.equal(r.get(),"foo","keeps prototype"),t.deepEqual(r.options,{a:1}),e.partial.placeholder=a,i=e.partial(function(){return arguments.length},a,"b",a,"d"),t.equal(i("a"),4,"allows the placeholder to be swapped out"),e.partial.placeholder={},i=e.partial(function(){return arguments.length},a,"b",a,"d"),t.equal(i("a"),5,"swapping the placeholder preserves previously bound arguments"),e.partial.placeholder=e}),QUnit.test("bindAll",function(t){var n={name:"curly"},a={name:"moe",getName:function(){return"name: "+this.name},sayHi:function(){return"hi: "+this.name}};n.getName=a.getName,e.bindAll(a,"getName","sayHi"),n.sayHi=a.sayHi,t.equal(n.getName(),"name: curly","unbound function is bound to current object"),t.equal(n.sayHi(),"hi: moe","bound function is still bound to original object"),n={name:"curly"},a={name:"moe",getName:function(){return"name: "+this.name},sayHi:function(){return"hi: "+this.name},sayLast:function(){return this.sayHi(e.last(arguments))}},t.raises(function(){e.bindAll(a)},Error,"throws an error for bindAll with no functions named"),t.raises(function(){e.bindAll(a,"sayBye")},TypeError,"throws an error for bindAll if the given key is undefined"),t.raises(function(){e.bindAll(a,"name")},TypeError,"throws an error for bindAll if the given key is not a function"),e.bindAll(a,"sayHi","sayLast"),n.sayHi=a.sayHi,t.equal(n.sayHi(),"hi: moe");var i=a.sayLast;t.equal(i(1,2,3,4,5,6,7,"Tom"),"hi: moe","createCallback works with any number of arguments"),e.bindAll(a,["getName"]);var o=a.getName;t.equal(o(),"name: moe","flattens arguments into a single list")}),QUnit.test("memoize",function(t){var n=function(e){return e<2?e:n(e-1)+n(e-2)};t.equal(n(10),55,"a memoized version of fibonacci produces identical results"),n=e.memoize(n),t.equal(n(10),55,"a memoized version of fibonacci produces identical results");var a=function(e){return e},i=e.memoize(a);t.equal(a("toString"),"toString","checks hasOwnProperty"),t.equal(i("toString"),"toString","checks hasOwnProperty");var o=e.memoize(function(e){return e.toUpperCase()});t.equal(o("foo"),"FOO"),t.equal(o("bar"),"BAR"),t.deepEqual(o.cache,{foo:"FOO",bar:"BAR"}),o.cache={foo:"BAR",bar:"FOO"},t.equal(o("foo"),"BAR"),t.equal(o("bar"),"FOO");var r=e.memoize(function(e){return t.ok(/[a-z]+/.test(e),"hasher doesn't change keys"),e},function(e){return e.toUpperCase()});r("yep"),t.deepEqual(r.cache,{YEP:"yep"},"takes a hasher");var l=e.memoize(function(e,t){return{key:t,value:e}},function(e,t){return t}),u=l("a","alpha"),c=l("b","alpha");t.notStrictEqual(u,void 0,"object is created if second argument used as key"),t.strictEqual(u,c,"object is cached if second argument used as key"),t.strictEqual(u.value,"a","object is not modified if second argument used as key")}),QUnit.test("delay",function(t){t.expect(2);var n=t.async(),a=!1;e.delay(function(){a=!0},100),setTimeout(function(){t.notOk(a,"didn't delay the function quite yet")},50),setTimeout(function(){t.ok(a,"delayed the function"),n()},150)}),QUnit.test("defer",function(t){t.expect(1);var n=t.async(),a=!1;e.defer(function(e){a=e},!0),e.delay(function(){t.ok(a,"deferred the function"),n()},50)}),QUnit.test("throttle",function(t){t.expect(2);var n=t.async(),a=0,i=function(){a++},o=e.throttle(i,32);o(),o(),t.equal(a,1,"incr was called immediately"),e.delay(function(){t.equal(a,2,"incr was throttled"),n()},64)}),QUnit.test("throttle arguments",function(t){t.expect(2);var n=t.async(),a=0,i=function(e){a=e},o=e.throttle(i,32);o(1),o(2),e.delay(function(){o(3)},64),t.equal(a,1,"updated to latest value"),e.delay(function(){t.equal(a,3,"updated to latest value"),n()},96)}),QUnit.test("throttle once",function(t){t.expect(2);var n=t.async(),a=0,i=function(){return++a},o=e.throttle(i,32),r=o();e.delay(function(){t.equal(r,1,"throttled functions return their value"),t.equal(a,1,"incr was called once"),n()},64)}),QUnit.test("throttle twice",function(t){t.expect(1);var n=t.async(),a=0,i=function(){a++},o=e.throttle(i,32);o(),o(),e.delay(function(){t.equal(a,2,"incr was called twice"),n()},64)}),QUnit.test("more throttling",function(t){t.expect(3);var n=t.async(),a=0,i=function(){a++},o=e.throttle(i,30);o(),o(),t.equal(a,1),e.delay(function(){t.equal(a,2),o(),t.equal(a,3),n()},85)}),QUnit.test("throttle repeatedly with results",function(t){t.expect(6);var n=t.async(),a=0,i=function(){return++a},o=e.throttle(i,100),r=[],l=function(){r.push(o())};l(),l(),e.delay(l,50),e.delay(l,150),e.delay(l,160),e.delay(l,230),e.delay(function(){t.equal(r[0],1,"incr was called once"),t.equal(r[1],1,"incr was throttled"),t.equal(r[2],1,"incr was throttled"),t.equal(r[3],2,"incr was called twice"),t.equal(r[4],2,"incr was throttled"),t.equal(r[5],3,"incr was called trailing"),n()},300)}),QUnit.test("throttle triggers trailing call when invoked repeatedly",function(t){t.expect(2);for(var n=t.async(),a=0,i=48,o=function(){a++},r=e.throttle(o,32),l=new Date;new Date-l<i;)r();var u=a;t.ok(a>1),e.delay(function(){t.ok(a>u),n()},96)}),QUnit.test("throttle does not trigger leading call when leading is set to false",function(t){t.expect(2);var n=t.async(),a=0,i=function(){a++},o=e.throttle(i,60,{leading:!1});o(),o(),t.equal(a,0),e.delay(function(){t.equal(a,1),n()},96)}),QUnit.test("more throttle does not trigger leading call when leading is set to false",function(t){t.expect(3);var n=t.async(),a=0,i=function(){a++},o=e.throttle(i,100,{leading:!1});o(),e.delay(o,50),e.delay(o,60),e.delay(o,200),t.equal(a,0),e.delay(function(){t.equal(a,1)},250),e.delay(function(){t.equal(a,2),n()},350)}),QUnit.test("one more throttle with leading: false test",function(t){t.expect(2);for(var n=t.async(),a=0,i=function(){a++},o=e.throttle(i,100,{leading:!1}),r=new Date;new Date-r<350;)o();t.ok(a<=3),e.delay(function(){t.ok(a<=4),n()},200)}),QUnit.test("throttle does not trigger trailing call when trailing is set to false",function(t){t.expect(4);var n=t.async(),a=0,i=function(){a++},o=e.throttle(i,60,{trailing:!1});o(),o(),o(),t.equal(a,1),e.delay(function(){t.equal(a,1),o(),o(),t.equal(a,2),e.delay(function(){t.equal(a,2),n()},96)},96)}),QUnit.test("throttle continues to function after system time is set backwards",function(t){t.expect(2);var n=t.async(),a=0,i=function(){a++},o=e.throttle(i,100),r=e.now;o(),t.equal(a,1),e.now=function(){return new Date(2013,0,1,1,1,1)},e.delay(function(){o(),t.equal(a,2),n(),e.now=r},200)}),QUnit.test("throttle re-entrant",function(t){t.expect(2);var n,a=t.async(),i=[["b1","b2"],["c1","c2"]],o="",r=function(e){o+=this+e;var t=i.pop();t&&n.call(t[0],t[1])};n=e.throttle(r,32),n.call("a1","a2"),t.equal(o,"a1a2"),e.delay(function(){t.equal(o,"a1a2c1c2b1b2","append was throttled successfully"),a()},100)}),QUnit.test("throttle cancel",function(t){var n=t.async(),a=0,i=function(){a++},o=e.throttle(i,32);o(),o.cancel(),o(),o(),t.equal(a,2,"incr was called immediately"),e.delay(function(){t.equal(a,3,"incr was throttled"),n()},64)}),QUnit.test("throttle cancel with leading: false",function(t){var n=t.async(),a=0,i=function(){a++},o=e.throttle(i,32,{leading:!1});o(),o.cancel(),t.equal(a,0,"incr was throttled"),e.delay(function(){t.equal(a,0,"incr was throttled"),n()},64)}),QUnit.test("debounce",function(t){t.expect(1);var n=t.async(),a=0,i=function(){a++},o=e.debounce(i,32);o(),o(),e.delay(o,16),e.delay(function(){t.equal(a,1,"incr was debounced"),n()},96)}),QUnit.test("debounce cancel",function(t){t.expect(1);var n=t.async(),a=0,i=function(){a++},o=e.debounce(i,32);o(),o.cancel(),e.delay(function(){t.equal(a,0,"incr was not called"),n()},96)}),QUnit.test("debounce asap",function(t){t.expect(6);var n,a,i,o=t.async(),r=0,l=function(){return++r},u=e.debounce(l,64,!0);n=u(),a=u(),t.equal(n,1),t.equal(a,1),t.equal(r,1,"incr was called immediately"),e.delay(u,16),e.delay(u,32),e.delay(u,48),e.delay(function(){t.equal(r,1,"incr was debounced"),i=u(),t.equal(i,2),t.equal(r,2,"incr was called again"),o()},128)}),QUnit.test("debounce asap cancel",function(t){t.expect(4);var n,a,i=t.async(),o=0,r=function(){return++o},l=e.debounce(r,64,!0);n=l(),l.cancel(),a=l(),t.equal(n,1),t.equal(a,2),t.equal(o,2,"incr was called immediately"),e.delay(l,16),e.delay(l,32),e.delay(l,48),e.delay(function(){t.equal(o,2,"incr was debounced"),i()},128)}),QUnit.test("debounce asap recursively",function(t){t.expect(2);var n=t.async(),a=0,i=e.debounce(function(){a++,a<10&&i()},32,!0);i(),t.equal(a,1,"incr was called immediately"),e.delay(function(){t.equal(a,1,"incr was debounced"),n()},96)}),QUnit.test("debounce after system time is set backwards",function(t){t.expect(2);var n=t.async(),a=0,i=e.now,o=e.debounce(function(){a++},100,!0);o(),t.equal(a,1,"incr was called immediately"),e.now=function(){return new Date(2013,0,1,1,1,1)},e.delay(function(){o(),t.equal(a,2,"incr was debounced successfully"),n(),e.now=i},200)}),QUnit.test("debounce re-entrant",function(t){t.expect(2);var n,a=t.async(),i=[["b1","b2"]],o="",r=function(e){o+=this+e;var t=i.pop();t&&n.call(t[0],t[1])};n=e.debounce(r,32),n.call("a1","a2"),t.equal(o,""),e.delay(function(){t.equal(o,"a1a2b1b2","append was debounced successfully"),a()},100)}),QUnit.test("once",function(t){var n=0,a=e.once(function(){return++n});a(),a(),t.equal(n,1),t.equal(a(),1,"stores a memo to the last value")}),QUnit.test("Recursive onced function.",function(t){t.expect(1);var n=e.once(function(){t.ok(!0),n()});n()}),QUnit.test("wrap",function(t){var n=function(e){return"hi: "+e},a=e.wrap(n,function(e,t){return e(t)+" "+t.split("").reverse().join("")});t.equal(a("moe"),"hi: moe eom","wrapped the salutation function");var i=function(){return"Hello "},o={name:"Moe"};o.hi=e.wrap(i,function(e){return e()+this.name}),t.equal(o.hi(),"Hello Moe");var r=function(){},l=e.wrap(r,function(){return Array.prototype.slice.call(arguments,0)}),u=l(["whats","your"],"vector","victor");t.deepEqual(u,[r,["whats","your"],"vector","victor"])}),QUnit.test("negate",function(t){var n=function(e){return 1&e};t.equal(e.negate(n)(2),!0,"should return the complement of the given function"),t.equal(e.negate(n)(3),!1,"should return the complement of the given function")}),QUnit.test("compose",function(t){function n(e,n,a){return t.equal(arguments.length,3,"First function called with multiple args"),a*n}function a(e){return t.equal(arguments.length,1,"Composed function is called with 1 argument"),e}function i(e){return t.equal(arguments.length,1,"Composed function is called with 1 argument"),2*e}var o=function(e){return"hi: "+e},r=function(e){return e+"!"},l=e.compose(r,o);t.equal(l("moe"),"hi: moe!","can compose a function that takes another"),l=e.compose(o,r),t.equal(l("moe"),"hi: moe!","in this case, the functions are also commutative"),l=e.compose(i,a,n),t.equal(l(1,2,3),12)}),QUnit.test("after",function(t){var n=function(t,n){for(var a=0,i=e.after(t,function(){a++});n--;)i();return a};t.equal(n(5,5),1,"after(N) should fire after being called N times"),t.equal(n(5,4),0,"after(N) should not fire unless called N times"),t.equal(n(0,0),0,"after(0) should not fire immediately"),t.equal(n(0,1),1,"after(0) should fire when first invoked")}),QUnit.test("before",function(t){var n=function(t,n){for(var a=0,i=e.before(t,function(){a++});n--;)i();return a};t.equal(n(5,5),4,"before(N) should not fire after being called N times"),t.equal(n(5,4),4,"before(N) should fire before being called N times"),t.equal(n(0,0),0,"before(0) should not fire immediately"),t.equal(n(0,1),0,"before(0) should not fire when first invoked");var a={num:0},i=e.before(3,function(){return++this.num});e.times(10,i,a),t.equal(i(),2,"stores a memo to the last value"),t.equal(a.num,2,"provides context")}),QUnit.test("iteratee",function(t){function n(){return arguments}var a=e.iteratee();t.equal(a,e.identity,"_.iteratee is exposed as an external function."),e.each([e.iteratee(n),e.iteratee(n,{})],function(n){t.equal(n().length,0),t.deepEqual(e.toArray(n(1,2,3)),e.range(1,4)),t.deepEqual(e.toArray(n(1,2,3,4,5,6,7,8,9,10)),e.range(1,11))});var i=e.iteratee;e.iteratee=function(t){return e.isRegExp(t)?function(e){return(e.match(t)||[]).length}:t};var o=["foo","bar","bbiz"];t.deepEqual(e.countBy(o,/b/g),{0:1,1:1,2:1}),t.equal(e.every(o,/b/g),!1),t.deepEqual(e.filter(o,/b/g),["bar","bbiz"]),t.equal(e.find(o,/b/g),"bar"),t.equal(e.findIndex(o,/b/g),1),t.equal(e.findKey(o,/b/g),1),t.equal(e.findLastIndex(o,/b/g),2),t.deepEqual(e.groupBy(o,/b/g),{0:["foo"],1:["bar"],2:["bbiz"]}),t.deepEqual(e.indexBy(o,/b/g),{0:"foo",1:"bar",2:"bbiz"}),t.deepEqual(e.map(o,/b/g),[0,1,2]),t.equal(e.max(o,/b/g),"bbiz"),t.equal(e.min(o,/b/g),"foo"),t.deepEqual(e.partition(o,/b/g),[["bar","bbiz"],["foo"]]),t.deepEqual(e.reject(o,/b/g),["foo"]),t.equal(e.some(o,/b/g),!0),t.deepEqual(e.sortBy(o,/b/g),["foo","bar","bbiz"]),t.equal(e.sortedIndex(o,"blah",/b/g),1),t.deepEqual(e.uniq(o,/b/g),["foo","bar","bbiz"]);var r={a:"foo",b:"bar",c:"bbiz"};t.deepEqual(e.mapObject(r,/b/g),{a:0,b:1,c:2}),e.iteratee=i}),QUnit.test("restArgs",function(t){t.expect(10),e.restArgs(function(e,n){t.strictEqual(e,1),t.deepEqual(n,[2,3],"collects rest arguments into an array")})(1,2,3),e.restArgs(function(e,n){t.strictEqual(e,void 0),t.deepEqual(n,[],"passes empty array if there are not enough arguments")})(),e.restArgs(function(e,n,a,i){t.strictEqual(arguments.length,4),t.deepEqual(i,[4,5],"works on functions with many named parameters")})(1,2,3,4,5);var n={};e.restArgs(function(){t.strictEqual(this,n,"invokes function with this context")}).call(n),e.restArgs(function(e,n,a){t.deepEqual(e,[1,2,3,4],"startIndex can be used manually specify index of rest parameter"),t.strictEqual(n,void 0),t.strictEqual(a,void 0)},0)(1,2,3,4)})}();