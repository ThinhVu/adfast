!function(e){var t;e.module("Backbone.View",{beforeEach:function(){$("#qunit-fixture").append('<div id="testElement"><h1>Test</h1></div>'),t=new Backbone.View({id:"test-view",className:"test-view",other:"non-special-option"})},afterEach:function(){$("#testElement").remove(),$("#test-view").remove()}}),e.test("constructor",function(e){e.expect(3),e.equal(t.el.id,"test-view"),e.equal(t.el.className,"test-view"),e.equal(t.el.other,void 0)}),e.test("$",function(e){e.expect(2);var t=new Backbone.View;t.setElement("<p><a><b>test</b></a></p>");var n=t.$("a b");e.strictEqual(n[0].innerHTML,"test"),e.ok(n.length===+n.length)}),e.test("$el",function(e){e.expect(3);var t=new Backbone.View;t.setElement("<p><a><b>test</b></a></p>"),e.strictEqual(t.el.nodeType,1),e.ok(t.$el instanceof Backbone.$),e.strictEqual(t.$el[0],t.el)}),e.test("initialize",function(e){e.expect(1);var t=Backbone.View.extend({initialize:function(){this.one=1}});e.strictEqual((new t).one,1)}),e.test("preinitialize",function(e){e.expect(1);var t=Backbone.View.extend({preinitialize:function(){this.one=1}});e.strictEqual((new t).one,1)}),e.test("preinitialize occurs before the view is set up",function(e){e.expect(2);var t=Backbone.View.extend({preinitialize:function(){e.equal(this.el,void 0)}}),n=new t({});e.notEqual(n.el,void 0)}),e.test("render",function(e){e.expect(1);var t=new Backbone.View;e.equal(t.render(),t,"#render returns the view instance")}),e.test("delegateEvents",function(e){e.expect(6);var t=0,n=0,i=new Backbone.View({el:"#testElement"});i.increment=function(){t++},i.$el.on("click",function(){n++});var c={"click h1":"increment"};i.delegateEvents(c),i.$("h1").trigger("click"),e.equal(t,1),e.equal(n,1),i.$("h1").trigger("click"),e.equal(t,2),e.equal(n,2),i.delegateEvents(c),i.$("h1").trigger("click"),e.equal(t,3),e.equal(n,3)}),e.test("delegate",function(e){e.expect(3);var t=new Backbone.View({el:"#testElement"});t.delegate("click","h1",function(){e.ok(!0)}),t.delegate("click",function(){e.ok(!0)}),t.$("h1").trigger("click"),e.equal(t.delegate(),t,"#delegate returns the view instance")}),e.test("delegateEvents allows functions for callbacks",function(e){e.expect(3);var t=new Backbone.View({el:"<p></p>"});t.counter=0;var n={click:function(){this.counter++}};t.delegateEvents(n),t.$el.trigger("click"),e.equal(t.counter,1),t.$el.trigger("click"),e.equal(t.counter,2),t.delegateEvents(n),t.$el.trigger("click"),e.equal(t.counter,3)}),e.test("delegateEvents ignore undefined methods",function(e){e.expect(0);var t=new Backbone.View({el:"<p></p>"});t.delegateEvents({click:"undefinedMethod"}),t.$el.trigger("click")}),e.test("undelegateEvents",function(e){e.expect(7);var t=0,n=0,i=new Backbone.View({el:"#testElement"});i.increment=function(){t++},i.$el.on("click",function(){n++});var c={"click h1":"increment"};i.delegateEvents(c),i.$("h1").trigger("click"),e.equal(t,1),e.equal(n,1),i.undelegateEvents(),i.$("h1").trigger("click"),e.equal(t,1),e.equal(n,2),i.delegateEvents(c),i.$("h1").trigger("click"),e.equal(t,2),e.equal(n,3),e.equal(i.undelegateEvents(),i,"#undelegateEvents returns the view instance")}),e.test("undelegate",function(e){e.expect(1);var t=new Backbone.View({el:"#testElement"});t.delegate("click",function(){e.ok(!1)}),t.delegate("click","h1",function(){e.ok(!1)}),t.undelegate("click"),t.$("h1").trigger("click"),t.$el.trigger("click"),e.equal(t.undelegate(),t,"#undelegate returns the view instance")}),e.test("undelegate with passed handler",function(e){e.expect(1);var t=new Backbone.View({el:"#testElement"}),n=function(){e.ok(!1)};t.delegate("click",n),t.delegate("click",function(){e.ok(!0)}),t.undelegate("click",n),t.$el.trigger("click")}),e.test("undelegate with selector",function(e){e.expect(2);var t=new Backbone.View({el:"#testElement"});t.delegate("click",function(){e.ok(!0)}),t.delegate("click","h1",function(){e.ok(!1)}),t.undelegate("click","h1"),t.$("h1").trigger("click"),t.$el.trigger("click")}),e.test("undelegate with handler and selector",function(e){e.expect(2);var t=new Backbone.View({el:"#testElement"});t.delegate("click",function(){e.ok(!0)});var n=function(){e.ok(!1)};t.delegate("click","h1",n),t.undelegate("click","h1",n),t.$("h1").trigger("click"),t.$el.trigger("click")}),e.test("tagName can be provided as a string",function(e){e.expect(1);var t=Backbone.View.extend({tagName:"span"});e.equal((new t).el.tagName,"SPAN")}),e.test("tagName can be provided as a function",function(e){e.expect(1);var t=Backbone.View.extend({tagName:function(){return"p"}});e.ok((new t).$el.is("p"))}),e.test("_ensureElement with DOM node el",function(e){e.expect(1);var t=Backbone.View.extend({el:document.body});e.equal((new t).el,document.body)}),e.test("_ensureElement with string el",function(e){e.expect(3);var t=Backbone.View.extend({el:"body"});e.strictEqual((new t).el,document.body),t=Backbone.View.extend({el:"#testElement > h1"}),e.strictEqual((new t).el,$("#testElement > h1").get(0)),t=Backbone.View.extend({el:"#nonexistent"}),e.ok(!(new t).el)}),e.test("with className and id functions",function(e){e.expect(2);var t=Backbone.View.extend({className:function(){return"className"},id:function(){return"id"}});e.strictEqual((new t).el.className,"className"),e.strictEqual((new t).el.id,"id")}),e.test("with attributes",function(e){e.expect(2);var t=Backbone.View.extend({attributes:{id:"id",class:"class"}});e.strictEqual((new t).el.className,"class"),e.strictEqual((new t).el.id,"id")}),e.test("with attributes as a function",function(e){e.expect(1);var t=Backbone.View.extend({attributes:function(){return{class:"dynamic"}}});e.strictEqual((new t).el.className,"dynamic")}),e.test("should default to className/id properties",function(e){e.expect(4);var t=Backbone.View.extend({className:"backboneClass",id:"backboneId",attributes:{class:"attributeClass",id:"attributeId"}}),n=new t;e.strictEqual(n.el.className,"backboneClass"),e.strictEqual(n.el.id,"backboneId"),e.strictEqual(n.$el.attr("class"),"backboneClass"),e.strictEqual(n.$el.attr("id"),"backboneId")}),e.test("multiple views per element",function(e){e.expect(3);var t=0,n=$("<p></p>"),i=Backbone.View.extend({el:n,events:{click:function(){t++}}}),c=new i;n.trigger("click"),e.equal(1,t);new i;n.trigger("click"),e.equal(3,t),c.delegateEvents(),n.trigger("click"),e.equal(5,t)}),e.test("custom events",function(e){e.expect(2);var t=Backbone.View.extend({el:$("body"),events:{fake$event:function(){e.ok(!0)}}});new t;$("body").trigger("fake$event").trigger("fake$event"),$("body").off("fake$event"),$("body").trigger("fake$event")}),e.test("#1048 - setElement uses provided object.",function(e){e.expect(2);var t=$("body"),n=new Backbone.View({el:t});e.ok(n.$el===t),n.setElement(t=$(t)),e.ok(n.$el===t)}),e.test("#986 - Undelegate before changing element.",function(e){e.expect(1);var t=$("<button></button>"),n=$("<button></button>"),i=Backbone.View.extend({events:{click:function(t){e.ok(c.el===t.target)}}}),c=new i({el:t});c.setElement(n),t.trigger("click"),n.trigger("click")}),e.test("#1172 - Clone attributes object",function(e){e.expect(2);var t=Backbone.View.extend({attributes:{foo:"bar"}}),n=new t({id:"foo"});e.strictEqual(n.el.id,"foo");var i=new t;e.ok(!i.el.id)}),e.test("views stopListening",function(e){e.expect(0);var t=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"all x",function(){e.ok(!1)}),this.listenTo(this.collection,"all x",function(){e.ok(!1)})}}),n=new t({model:new Backbone.Model,collection:new Backbone.Collection});n.stopListening(),n.model.trigger("x"),n.collection.trigger("x")}),e.test("Provide function for el.",function(e){e.expect(2);var t=Backbone.View.extend({el:function(){return"<p><a></a></p>"}}),n=new t;e.ok(n.$el.is("p")),e.ok(n.$el.has("a"))}),e.test("events passed in options",function(e){e.expect(1);var t=0,n=Backbone.View.extend({el:"#testElement",increment:function(){t++}}),i=new n({events:{"click h1":"increment"}});i.$("h1").trigger("click").trigger("click"),e.equal(t,2)}),e.test("remove",function(e){e.expect(2);var n=new Backbone.View;document.body.appendChild(t.el),n.delegate("click",function(){e.ok(!1)}),n.listenTo(n,"all x",function(){e.ok(!1)}),e.equal(n.remove(),n,"#remove returns the view instance"),n.$el.trigger("click"),n.trigger("x"),e.notEqual(n.el.parentNode,document.body)}),e.test("setElement",function(e){e.expect(3);var t=new Backbone.View({events:{click:function(){e.ok(!1)}}});t.events={click:function(){e.ok(!0)}};var n=t.el,i=t.$el;t.setElement(document.createElement("div")),i.click(),t.$el.click(),e.notEqual(n,t.el),e.notEqual(i,t.$el)})}(QUnit);