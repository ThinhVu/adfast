!function(e){var t,a=Backbone.Collection.extend({url:function(){return"/library"}}),s={title:"The Tempest",author:"Bill Shakespeare",length:123};e.module("Backbone.sync",{beforeEach:function(e){t=new a,t.create(s,{wait:!1})},afterEach:function(e){Backbone.emulateHTTP=!1}}),e.test("read",function(e){e.expect(4),t.fetch(),e.equal(this.ajaxSettings.url,"/library"),e.equal(this.ajaxSettings.type,"GET"),e.equal(this.ajaxSettings.dataType,"json"),e.ok(_.isEmpty(this.ajaxSettings.data))}),e.test("passing data",function(e){e.expect(3),t.fetch({data:{a:"a",one:1}}),e.equal(this.ajaxSettings.url,"/library"),e.equal(this.ajaxSettings.data.a,"a"),e.equal(this.ajaxSettings.data.one,1)}),e.test("create",function(e){e.expect(6),e.equal(this.ajaxSettings.url,"/library"),e.equal(this.ajaxSettings.type,"POST"),e.equal(this.ajaxSettings.dataType,"json");var t=JSON.parse(this.ajaxSettings.data);e.equal(t.title,"The Tempest"),e.equal(t.author,"Bill Shakespeare"),e.equal(t.length,123)}),e.test("update",function(e){e.expect(7),t.first().save({id:"1-the-tempest",author:"William Shakespeare"}),e.equal(this.ajaxSettings.url,"/library/1-the-tempest"),e.equal(this.ajaxSettings.type,"PUT"),e.equal(this.ajaxSettings.dataType,"json");var a=JSON.parse(this.ajaxSettings.data);e.equal(a.id,"1-the-tempest"),e.equal(a.title,"The Tempest"),e.equal(a.author,"William Shakespeare"),e.equal(a.length,123)}),e.test("update with emulateHTTP and emulateJSON",function(e){e.expect(7),t.first().save({id:"2-the-tempest",author:"Tim Shakespeare"},{emulateHTTP:!0,emulateJSON:!0}),e.equal(this.ajaxSettings.url,"/library/2-the-tempest"),e.equal(this.ajaxSettings.type,"POST"),e.equal(this.ajaxSettings.dataType,"json"),e.equal(this.ajaxSettings.data._method,"PUT");var a=JSON.parse(this.ajaxSettings.data.model);e.equal(a.id,"2-the-tempest"),e.equal(a.author,"Tim Shakespeare"),e.equal(a.length,123)}),e.test("update with just emulateHTTP",function(e){e.expect(6),t.first().save({id:"2-the-tempest",author:"Tim Shakespeare"},{emulateHTTP:!0}),e.equal(this.ajaxSettings.url,"/library/2-the-tempest"),e.equal(this.ajaxSettings.type,"POST"),e.equal(this.ajaxSettings.contentType,"application/json");var a=JSON.parse(this.ajaxSettings.data);e.equal(a.id,"2-the-tempest"),e.equal(a.author,"Tim Shakespeare"),e.equal(a.length,123)}),e.test("update with just emulateJSON",function(e){e.expect(6),t.first().save({id:"2-the-tempest",author:"Tim Shakespeare"},{emulateJSON:!0}),e.equal(this.ajaxSettings.url,"/library/2-the-tempest"),e.equal(this.ajaxSettings.type,"PUT"),e.equal(this.ajaxSettings.contentType,"application/x-www-form-urlencoded");var a=JSON.parse(this.ajaxSettings.data.model);e.equal(a.id,"2-the-tempest"),e.equal(a.author,"Tim Shakespeare"),e.equal(a.length,123)}),e.test("read model",function(e){e.expect(3),t.first().save({id:"2-the-tempest",author:"Tim Shakespeare"}),t.first().fetch(),e.equal(this.ajaxSettings.url,"/library/2-the-tempest"),e.equal(this.ajaxSettings.type,"GET"),e.ok(_.isEmpty(this.ajaxSettings.data))}),e.test("destroy",function(e){e.expect(3),t.first().save({id:"2-the-tempest",author:"Tim Shakespeare"}),t.first().destroy({wait:!0}),e.equal(this.ajaxSettings.url,"/library/2-the-tempest"),e.equal(this.ajaxSettings.type,"DELETE"),e.equal(this.ajaxSettings.data,null)}),e.test("destroy with emulateHTTP",function(e){e.expect(3),t.first().save({id:"2-the-tempest",author:"Tim Shakespeare"}),t.first().destroy({emulateHTTP:!0,emulateJSON:!0}),e.equal(this.ajaxSettings.url,"/library/2-the-tempest"),e.equal(this.ajaxSettings.type,"POST"),e.equal(JSON.stringify(this.ajaxSettings.data),'{"_method":"DELETE"}')}),e.test("urlError",function(e){e.expect(2);var t=new Backbone.Model;e.raises(function(){t.fetch()}),t.fetch({url:"/one/two"}),e.equal(this.ajaxSettings.url,"/one/two")}),e.test("#1052 - `options` is optional.",function(e){e.expect(0);var t=new Backbone.Model;t.url="/test",Backbone.sync("create",t)}),e.test("Backbone.ajax",function(e){e.expect(1),Backbone.ajax=function(t){e.strictEqual(t.url,"/test")};var t=new Backbone.Model;t.url="/test",Backbone.sync("create",t)}),e.test("Call provided error callback on error.",function(e){e.expect(1);var t=new Backbone.Model;t.url="/test",Backbone.sync("read",t,{error:function(){e.ok(!0)}}),this.ajaxSettings.error()}),e.test("Use Backbone.emulateHTTP as default.",function(e){e.expect(2);var t=new Backbone.Model;t.url="/test",Backbone.emulateHTTP=!0,t.sync("create",t),e.strictEqual(this.ajaxSettings.emulateHTTP,!0),Backbone.emulateHTTP=!1,t.sync("create",t),e.strictEqual(this.ajaxSettings.emulateHTTP,!1)}),e.test("Use Backbone.emulateJSON as default.",function(e){e.expect(2);var t=new Backbone.Model;t.url="/test",Backbone.emulateJSON=!0,t.sync("create",t),e.strictEqual(this.ajaxSettings.emulateJSON,!0),Backbone.emulateJSON=!1,t.sync("create",t),e.strictEqual(this.ajaxSettings.emulateJSON,!1)}),e.test("#1756 - Call user provided beforeSend function.",function(e){e.expect(4),Backbone.emulateHTTP=!0;var t=new Backbone.Model;t.url="/test";var a={setRequestHeader:function(t,a){e.strictEqual(t,"X-HTTP-Method-Override"),e.strictEqual(a,"DELETE")}};t.sync("delete",t,{beforeSend:function(t){return e.ok(t===a),!1}}),e.strictEqual(this.ajaxSettings.beforeSend(a),!1)}),e.test("#2928 - Pass along `textStatus` and `errorThrown`.",function(e){e.expect(2);var t=new Backbone.Model;t.url="/test",t.on("error",function(t,a,s){e.strictEqual(s.textStatus,"textStatus"),e.strictEqual(s.errorThrown,"errorThrown")}),t.fetch(),this.ajaxSettings.error({},"textStatus","errorThrown")})}(QUnit);